<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Markdown Rendering</title>
    <link rel="stylesheet" href="file:///android_asset/highlight-styles-default.css">
    <script src="file:///android_asset/marked.js"></script>
    <script src="file:///android_asset/highlight.js"></script>
    <script type="text/javascript" id="MathJax-script" defer src="file:///android_asset/mathjax-tex-svg.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [["$", "$"], ["\\(", "\\)"]]
            },
            svg: {
                fontCache: "global"
            }
        };

        const COLLAPSED_HEIGHT = 72;
        var isCollapsed = true;
        var hasReasoningContent = false;

        function updateReasoning() {
            const element = document.getElementById("reasoningContent");
            const toggleBtn = document.getElementById("toggleReasoningBtn");

            if (hasReasoningContent) {
                element.style.display = "block";
                toggleBtn.style.display = "inline";
            } else {
                element.style.display = "none";
                toggleBtn.style.display = "none";
                return;
            }

            if (isCollapsed) {
                toggleBtn.textContent = "Show Reasoning";
            } else {
                toggleBtn.textContent = "Hide Reasoning";
            }

            if (isCollapsed && element.clientHeight >= COLLAPSED_HEIGHT) {
                requestAnimationFrame(() => {
                    element.style.height = COLLAPSED_HEIGHT + "px";
                });
            } else {
                requestAnimationFrame(() => {
                    element.style.height = element.scrollHeight + "px";
                });
            }
        }

        function toggleReasoning() {
            isCollapsed = !isCollapsed;
            updateReasoning();
        }

        function renderMarkdown(content) {
            var html = marked.parse(content);
            var element = document.getElementById("content");
            if (!element) {
                console.error("Element with id 'content' not found.");
                return "Failed";
            }
            element.innerHTML = html;
            MathJax.typesetPromise([element]).then(function () {
                element.querySelectorAll("pre code").forEach((block) => {
                    hljs.highlightBlock(block);
                });
            }).catch(function (err) {
                console.error("MathJax typesetting failed: " + err.message);
            });
        }

        function renderReasoningMarkdown(reasoningContent) {
            hasReasoningContent = reasoningContent != "";
            var html = marked.parse(reasoningContent);
            var element = document.getElementById("reasoningContent");
            if (!element) {
                console.error("Element with id 'reasoningContent' not found.");
                return "Failed";
            }
            element.innerHTML = html;
            MathJax.typesetPromise([element]).then(function () {
                element.querySelectorAll("pre code").forEach((block) => {
                    hljs.highlightBlock(block);
                });
            }).catch(function (err) {
                console.error("MathJax typesetting failed: " + err.message);
            });
            updateReasoning();
        }

        function getActualLineCount(element) {
            const style = window.getComputedStyle(element);
            const lineHeight = parseFloat(style.lineHeight);
            const height = parseFloat(style.height);
            return Math.round(height / lineHeight);
        }
    </script>
    <style>
        body {
            font-family: sans-serif;
        }

        .toggle-button {
            background: transparent;
            border: none;
            color: grey;
            cursor: pointer;
            font-size: 1em;
            margin: 10px 0;
            padding: 0;
            display: none;
        }

        #reasoningContent {
            border-left: 4px solid #ccc;
            margin: 1em 0;
            padding: 0 1em;
            color: grey;
            overflow: hidden;
            display: block;
            height: auto;
            transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>

<body style="margin:0; padding:0;">
<button id="toggleReasoningBtn" class="toggle-button" onclick="toggleReasoning()">Show Reasoning</button>
<blockquote id="reasoningContent"></blockquote>
<div id="content"></div>
</body>

</html>
